---
phase: 04-launch
plan: "02"
type: execute
wave: 2
depends_on: [04-01]
files_modified: []
autonomous: false
requirements: [REL-04]

must_haves:
  truths:
    - "docker pull ghcr.io/d44b/pulltrace-agent:0.1.0 succeeds from an unauthenticated shell"
    - "docker pull ghcr.io/d44b/pulltrace-server:0.1.0 succeeds from an unauthenticated shell"
    - "The GitHub Releases page shows v0.1.0 with a release body, install commands, and an attached .tgz asset"
    - "helm install pulltrace pulltrace/pulltrace --version 0.1.0 resolves the chart from the classic Helm repo"
    - "https://d44b.github.io/pulltrace/charts/index.yaml contains a version: 0.1.0 entry"
    - "https://d44b.github.io/pulltrace/ still serves the docs site (gh-pages root not overwritten)"
  artifacts:
    - path: "https://github.com/d44b/pulltrace/releases/tag/v0.1.0"
      provides: "GitHub Release page with title, body, and attached helm chart .tgz"
    - path: "https://d44b.github.io/pulltrace/charts/index.yaml"
      provides: "Helm classic repo index with 0.1.0 chart entry"
    - path: "ghcr.io/d44b/pulltrace-agent:0.1.0"
      provides: "Public Docker image, agent, tagged 0.1.0"
    - path: "ghcr.io/d44b/pulltrace-server:0.1.0"
      provides: "Public Docker image, server, tagged 0.1.0"
    - path: "ghcr.io/d44b/charts/pulltrace:0.1.0"
      provides: "OCI Helm chart, tagged 0.1.0"
  key_links:
    - from: "git tag v0.1.0"
      to: "CI pipeline (ci.yml)"
      via: "on: push: tags: ['v*.*.*']"
      pattern: "refs/tags/v0.1.0 triggers all downstream jobs"
    - from: "helm-release job"
      to: "gh-pages /charts/"
      via: "peaceiris/actions-gh-pages destination_dir:charts keep_files:true"
      pattern: "index.yaml deployed to /charts/ not root"
    - from: "github-release job"
      to: "GitHub Release v0.1.0"
      via: "softprops/action-gh-release@v2 needs:[helm-release]"
      pattern: "release created only after helm index is live"
---

<objective>
Push git tag v0.1.0 to trigger the CI pipeline, monitor the run to completion, and verify every v0.1.0 artifact is publicly reachable.

Purpose: This is the actual launch gate. All CI automation was built and verified in Phase 3. The tag push fires the full pipeline (lint-test → build-ui → helm-lint → docker ×2 → helm-release → github-release) and produces all v0.1.0 artifacts in a single run.

Output: No source files modified. Git tag v0.1.0 pushed to origin. All v0.1.0 artifacts live at their public URLs.
</objective>

<execution_context>
@/Users/jmaciejewski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jmaciejewski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-launch/04-RESEARCH.md
@.planning/phases/03-release-automation/03-01-SUMMARY.md
@.planning/phases/03-release-automation/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pre-flight checks and push git tag v0.1.0</name>
  <files></files>
  <action>
Run pre-flight checks, then create and push the annotated tag.

**Pre-flight (run in order, abort if any fail):**

```bash
# 1. Confirm on main branch with clean working tree
git status
git branch --show-current
# Expected: "main", no uncommitted changes

# 2. Confirm Chart.yaml has correct version (already set in earlier phases but verify)
grep -E "^version:|^appVersion:" /Users/jmaciejewski/workspace/pulltrace/charts/pulltrace/Chart.yaml
# Expected: version: 0.1.0 / appVersion: "0.1.0"

# 3. Confirm ci.yml has the github-release job (from Phase 3)
grep -c "github-release:" /Users/jmaciejewski/workspace/pulltrace/.github/workflows/ci.yml
# Expected: 1 (at least one match)

# 4. Confirm no existing v0.1.0 tag (avoid duplicate tag error)
git tag --list "v0.1.0"
# Expected: empty output. If "v0.1.0" appears, check if it was a test tag and delete: git tag -d v0.1.0 && git push origin :v0.1.0

# 5. Confirm packages are public (from Plan 04-01)
curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-agent/tags/list
curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-server/tags/list
# Expected: 200 (public) for both. 401 means Plan 04-01 was not completed — ABORT.
```

**If all pre-flight checks pass, create and push the tag:**

```bash
git tag -a v0.1.0 -m "Release v0.1.0"
git push origin v0.1.0
```

Do NOT use `git push --tags` — that pushes all local tags, not just v0.1.0.

**After push, note the CI run URL:**
```bash
# Wait ~10 seconds for GitHub to register the push, then find the run
gh run list --workflow=ci.yml --repo d44b/pulltrace --limit 3
# Note the run ID for the v0.1.0 tag push
```

**Monitor CI to completion:**
```bash
# Replace RUN_ID with the run ID from above
gh run watch RUN_ID --repo d44b/pulltrace
# This blocks until the run completes (passes or fails). Expected duration: ~5-10 minutes.
```

If the CI run fails, inspect the failing job:
```bash
gh run view RUN_ID --repo d44b/pulltrace --log-failed
```

**Expected CI job sequence (all must be green):**
```
lint-test       → PASS
build-ui        → PASS
helm-lint       → PASS
docker (agent)  → PASS  (pushes ghcr.io/d44b/pulltrace-agent:0.1.0)
docker (server) → PASS  (pushes ghcr.io/d44b/pulltrace-server:0.1.0)
helm-release    → PASS  (pushes OCI chart, deploys index.yaml to gh-pages /charts/)
github-release  → PASS  (creates GitHub Release v0.1.0 with .tgz asset)
```
  </action>
  <verify>
    <automated>gh run list --workflow=ci.yml --repo d44b/pulltrace --limit 1 --json conclusion,headBranch,event --jq '.[0] | "\(.event) \(.headBranch) \(.conclusion)"'</automated>
    <manual>Output should show "push refs/tags/v0.1.0 success" (or equivalent). All 7 jobs green in the GitHub Actions UI at https://github.com/d44b/pulltrace/actions.</manual>
  </verify>
  <done>git tag v0.1.0 exists on origin; CI run triggered by the tag push completed with all jobs green.</done>
</task>

<task type="auto">
  <name>Task 2: Run post-launch artifact verification checklist</name>
  <files></files>
  <action>
Run every verification command from the Phase 4 research. All checks must pass. Report any failures with the specific error.

**Check 1 — Unauthenticated Docker pull (agent):**
```bash
docker logout ghcr.io
docker pull ghcr.io/d44b/pulltrace-agent:0.1.0
```
Expected: Pull completes. "Status: Downloaded newer image" or "Status: Image is up to date".
Failure signal: "unauthorized" or "pull access denied" → packages not public (Plan 04-01 incomplete).

**Check 2 — Unauthenticated Docker pull (server):**
```bash
docker pull ghcr.io/d44b/pulltrace-server:0.1.0
```
Expected: Pull completes without auth error.

**Check 3 — GitHub Release exists:**
```bash
gh release view v0.1.0 --repo d44b/pulltrace
```
Expected: Shows release title, body (with helm install commands), and attached asset `pulltrace-0.1.0.tgz`.
Failure signal: "release not found" → github-release CI job did not complete.

**Check 4 — Helm classic repo resolves 0.1.0:**
```bash
helm repo add pulltrace https://d44b.github.io/pulltrace/charts 2>/dev/null || true
helm repo update
helm search repo pulltrace --version 0.1.0
```
Expected: Shows `pulltrace/pulltrace   0.1.0   0.1.0` in results.
Failure signal: No output → index.yaml does not have the 0.1.0 entry yet.

**Check 5 — index.yaml contains 0.1.0 entry:**
```bash
curl -s https://d44b.github.io/pulltrace/charts/index.yaml | grep "version: 0.1.0"
```
Expected: Line `  version: 0.1.0` present.

**Check 6 — OCI Helm chart is reachable:**
```bash
helm show chart oci://ghcr.io/d44b/charts/pulltrace --version 0.1.0
```
Expected: Returns Chart.yaml content (name: pulltrace, version: 0.1.0).
Failure signal: "Error: failed to fetch" or auth error.

**Check 7 — Docs site is intact (not overwritten by helm-release):**
```bash
curl -s -o /dev/null -w "%{http_code}" https://d44b.github.io/pulltrace/
```
Expected: 200. Failure signal: 404 → gh-pages root was overwritten (keep_files:true regression).

**Check 8 — Docs site at /charts/ also intact:**
```bash
curl -s -o /dev/null -w "%{http_code}" https://d44b.github.io/pulltrace/charts/index.yaml
```
Expected: 200.

If all 8 checks pass: the launch is complete. Record all results in the SUMMARY.

If any check fails:
- Checks 1-2 fail: packages may still be private — re-run Plan 04-01 steps.
- Check 3 fails: `github-release` CI job failed — inspect with `gh run view --log-failed`.
- Checks 4-5 fail: `helm-release` CI job failed or gh-pages deploy has not propagated yet (wait 2 minutes and retry).
- Check 6 fails: `charts/pulltrace` OCI package may still be private — set visibility per Plan 04-01 steps for this package.
- Check 7 fails: `keep_files: true` was accidentally removed from docs.yml — inspect gh-pages branch state.
  </action>
  <verify>
    <automated>curl -s -o /dev/null -w "%{http_code}" https://d44b.github.io/pulltrace/charts/index.yaml && curl -s https://d44b.github.io/pulltrace/charts/index.yaml | grep "version: 0.1.0" && gh release view v0.1.0 --repo d44b/pulltrace --json tagName --jq '.tagName'</automated>
    <manual>All 8 checks above return the expected outputs. Specifically: docker pulls succeed unauthenticated, GitHub Release page shows v0.1.0 with .tgz asset, helm search repo shows 0.1.0, docs site at root returns 200.</manual>
  </verify>
  <done>All 8 post-launch checks pass. v0.1.0 artifacts are publicly reachable by an unauthenticated user. Project is in announcement-ready state.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Final human verification — project is announcement-ready</name>
  <files></files>
  <action>
Task 1 pushed the v0.1.0 tag and CI ran to completion. Task 2 ran the automated artifact verification checklist. Visually confirm the following in your browser:

1. **GitHub Release page**: https://github.com/d44b/pulltrace/releases/tag/v0.1.0
   - Title shows "Pulltrace v0.1.0" (or similar)
   - Body contains helm install commands
   - Asset `pulltrace-0.1.0.tgz` is attached
   - Marked as "Latest release"

2. **Docs site**: https://d44b.github.io/pulltrace/
   - MkDocs Material site loads (not a 404 or raw index.html)
   - Navigation shows Installation, Configuration, Architecture pages

3. **Helm repo index**: https://d44b.github.io/pulltrace/charts/index.yaml
   - Raw YAML loads in browser
   - Contains `version: 0.1.0` entry

Note: The CHANGELOG.md comparison links that were 404s in Phase 1 will now resolve correctly because the v0.1.0 tag exists.
  </action>
  <verify>
    <automated>gh release view v0.1.0 --repo d44b/pulltrace --json tagName,assets --jq '{tag: .tagName, assets: [.assets[].name]}'</automated>
    <manual>Browser: GitHub Release page shows v0.1.0 with .tgz asset; docs site at https://d44b.github.io/pulltrace/ loads MkDocs Material site; index.yaml loads and contains version: 0.1.0.</manual>
  </verify>
  <done>Human confirms all v0.1.0 artifacts are live, accessible, and the project is in announcement-ready state.</done>
  <resume-signal>Type "launch verified" if all artifacts are live and correct. Describe any issues found if not.</resume-signal>
</task>

</tasks>

<verification>
Phase 4 complete when all of the following are true:

```bash
# 1. Tag exists on remote
git ls-remote --tags origin v0.1.0

# 2. CI run for tag completed successfully
gh run list --workflow=ci.yml --repo d44b/pulltrace --limit 1 --json conclusion --jq '.[0].conclusion'
# → "success"

# 3. GitHub Release exists
gh release view v0.1.0 --repo d44b/pulltrace --json tagName,assets --jq '{tag: .tagName, assets: [.assets[].name]}'
# → {"tag":"v0.1.0","assets":["pulltrace-0.1.0.tgz"]}

# 4. Unauthenticated image pull
docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-agent:0.1.0
# → succeeds

# 5. Helm classic repo
curl -s https://d44b.github.io/pulltrace/charts/index.yaml | grep "version: 0.1.0"
# → "  version: 0.1.0"

# 6. Docs site intact
curl -s -o /dev/null -w "%{http_code}" https://d44b.github.io/pulltrace/
# → 200
```
</verification>

<success_criteria>
- `git ls-remote --tags origin v0.1.0` shows the tag
- CI run triggered by v0.1.0 tag completed with conclusion "success" (all 7 jobs green)
- `gh release view v0.1.0 --repo d44b/pulltrace` returns a release with title, body, and attached `.tgz`
- `docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-agent:0.1.0` pulls without auth error
- `docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-server:0.1.0` pulls without auth error
- `curl -s https://d44b.github.io/pulltrace/charts/index.yaml | grep "version: 0.1.0"` returns a match
- `helm search repo pulltrace --version 0.1.0` shows the chart entry
- `curl -s -o /dev/null -w "%{http_code}" https://d44b.github.io/pulltrace/` returns 200
- Human confirms all artifacts are live and project is announcement-ready
</success_criteria>

<output>
After completion, create `.planning/phases/04-launch/04-02-SUMMARY.md`

Required frontmatter fields:
- phase, plan, subsystem, tags, dependency_graph, tech_stack, key_files, decisions, metrics

Required body sections:
- What Was Done (per task — include CI run URL, all check results)
- Must-Haves Verification table (all 6 truths verified)
- Commits (git tag push: `git tag v0.1.0 pushed to origin` — not a code commit)
- Deviations from Plan
- Self-Check: PASSED or FAILED
</output>
