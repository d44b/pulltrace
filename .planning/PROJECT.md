# Pulltrace

## What This Is

Pulltrace is a real-time Kubernetes image pull monitor. A DaemonSet agent on each node reads containerd's content store, reports layer-by-layer pull progress to a central server, which aggregates multi-node state and streams live updates to a React dashboard via SSE. The goal is to make `ImagePullBackOff` waits visible and observable.

## Core Value

A DevOps engineer deploying to Kubernetes can see exactly which images are pulling, how fast, which pods are waiting, and when they'll be ready — without kubectl exec or log digging.

## Project Readiness Assessment

Rated against: usability, features, open-source completeness, release process.

| Dimension | Score | Notes |
|-----------|-------|-------|
| **Usability** | 6/10 | Core UI is functional with real-time bars, filters, layer drill-down. Missing: easy quickstart path, hosted docs for onboarding |
| **Features** | 7/10 | Core set complete (agent + server + SSE + UI + pod correlation + Prometheus). Minor gaps: PullErrors metric broken, layer bytesPerSec not populated |
| **Open source** | 4/10 | Apache 2.0 ✓, SECURITY.md ✓, ADRs ✓. Missing: CONTRIBUTING.md, CHANGELOG.md, GitHub Releases, GitHub Pages docs site |
| **Release process** | 5/10 | CI pipeline solid (lint/test/docker push/helm OCI push on tag). Missing: actual v0.1.0 tag, no GitHub Releases, OCI-only helm install is non-obvious |
| **Overall** | **5.5/10** | Product core is solid — the release wrapper (docs, discoverability, publishing) is what's missing |

**What's needed to ship v0.1.0:**
- GitHub Pages documentation site (not just README)
- Traditional `helm repo add` or clearly documented OCI install flow
- CONTRIBUTING.md + CHANGELOG.md
- GitHub Release with notes triggered by `git tag v0.1.0`
- Fix the two minor known bugs (PullErrors metric, layer speed field)

## Requirements

### Validated

<!-- Shipped and confirmed — inferred from existing codebase -->

- ✓ Agent DaemonSet reads containerd socket and reports pull state every 1s — existing
- ✓ Server aggregates multi-node AgentReports into unified PullStatus map — existing
- ✓ SSE stream broadcasts PullEvent updates to all connected clients — existing
- ✓ React UI renders live pull rows with progress bars, speed gauge, filters — existing
- ✓ Layer-level drill-down in UI (LayerDetail component) — existing
- ✓ Pod correlation via Kubernetes API (identifies waiting pods for each pull) — existing
- ✓ Prometheus metrics on port 9090 (pulls active, total, duration, bytes, SSE clients) — existing
- ✓ Optional Bearer token auth for agent → server communication — existing
- ✓ Helm chart for full Kubernetes deployment (DaemonSet + Deployment + RBAC) — existing
- ✓ Docker images (agent + server) published to GHCR on tag via CI — existing
- ✓ Helm chart published to GHCR OCI registry on tag via CI — existing
- ✓ Apache 2.0 license — existing
- ✓ SECURITY.md threat model — existing
- ✓ Architecture Decision Records (ADRs) — existing
- ✓ README with architecture diagram and quick-start — existing

### Active

<!-- Release v0.1.0 — what we're building toward -->

- [ ] GitHub Pages documentation site (installation guide, configuration reference, architecture overview)
- [ ] Traditional Helm repository on GitHub Pages (`helm repo add pulltrace https://...`) OR clear OCI helm install docs
- [ ] CONTRIBUTING.md (dev setup, build process, PR guidelines)
- [ ] CHANGELOG.md (keep-a-changelog format, unreleased section)
- [ ] GitHub Release for v0.1.0 with release notes (triggered by `git tag v0.1.0`)
- [ ] Fix PullErrors Prometheus metric (currently defined but never incremented)
- [ ] Fix layer bytesPerSec and mediaType fields (populated server-side, consumed by LayerDetail)
- [ ] Repository metadata: GitHub topics, description, social preview image

### Out of Scope

- Persistent storage (Redis/etcd for pull history) — in-memory with 30m TTL is sufficient for v0.1.0
- UI authentication — assumes ingress-level auth or private cluster network
- Mobile app / CLI — web UI is the interface for v0.1.0
- Multi-cluster federation — single cluster per deployment for v0.1.0
- Slack/PagerDurty alerting — Prometheus integration covers this use case

## Context

- **Existing GHCR setup:** Docker images at `ghcr.io/d44b/pulltrace-{agent,server}`, Helm chart at `ghcr.io/d44b/charts/pulltrace`
- **OCI helm install** works with `helm install pulltrace oci://ghcr.io/d44b/charts/pulltrace --version 0.1.0` — needs documenting
- **Traditional helm repo** requires a GitHub Pages branch with a `index.yaml` generated by `helm repo index` — would make `helm repo add` work
- **GitHub Pages** can host both the Helm repo index AND the docs site (as subdirectory or separate path)
- **No git tags exist yet** — v0.1.0 hasn't been released; CI is wired and ready
- **Go 1.22 required** — local machines with older Go must use Docker or CI to build
- **Frontend build:** `npm run build` in `web/`, outputs to `web/dist/` which is embedded in server binary

## Constraints

- **Tech stack:** Go 1.22, React + Vite, Helm 3, GitHub Actions — no new languages or platforms
- **Hosting:** GitHub free tier only — GitHub Pages for docs + GHCR for images/charts
- **No external services:** No paid CI, no external doc hosting (Netlify, Vercel, etc.)
- **OCI helm vs classic:** GHCR OCI is already wired; can add GitHub Pages helm repo alongside without breaking OCI

## Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| OCI helm chart registry (GHCR) | Already wired in CI; free, authenticated | — Pending: needs `helm repo add` alternative or docs |
| GitHub Pages for docs | Free, co-located with repo, supports Jekyll/plain HTML | — Pending: needs implementation |
| v0.1.0 as first release | Feature-complete core; stabilize before adding features | — Pending: blocked on docs + release workflow |
| Apache 2.0 license | Permissive, compatible with containerd and client-go deps | ✓ Good |

---
*Last updated: 2026-02-23 after initialization*
