---
phase: 04-launch
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false
requirements: [REL-03]

must_haves:
  truths:
    - "An unauthenticated user can run docker pull ghcr.io/d44b/pulltrace-agent:latest without receiving a 401"
    - "An unauthenticated user can run docker pull ghcr.io/d44b/pulltrace-server:latest without receiving a 401"
    - "An unauthenticated user can run helm show chart oci://ghcr.io/d44b/charts/pulltrace without receiving an auth error"
  artifacts:
    - path: "https://github.com/users/d44b/packages/container/pulltrace-agent/settings"
      provides: "GHCR pulltrace-agent package — public visibility setting"
    - path: "https://github.com/users/d44b/packages/container/pulltrace-server/settings"
      provides: "GHCR pulltrace-server package — public visibility setting"
    - path: "https://github.com/users/d44b/packages/container/charts%2Fpulltrace/settings"
      provides: "GHCR charts/pulltrace OCI package — public visibility setting"
  key_links:
    - from: "ghcr.io/d44b/pulltrace-agent"
      to: "public internet"
      via: "GHCR package visibility = Public"
      pattern: "no auth required for docker pull"
    - from: "ghcr.io/d44b/charts/pulltrace"
      to: "public internet"
      via: "GHCR package visibility = Public"
      pattern: "no auth required for helm install oci://"
---

<objective>
Make all three GHCR packages public so that unauthenticated users can pull images and install the Helm chart after the v0.1.0 tag fires.

Purpose: CI pushes images to GHCR with provenance:false (workaround from Phase 3). Packages default to private on GHCR. If the tag is pushed before packages are public, the CI run succeeds but all images remain inaccessible to unauthenticated users — including Kubernetes nodes trying to pull the containers. This step has no CLI/API substitute; it requires the GitHub Web UI.

Output: Three GHCR packages with public visibility. No files created or modified.
</objective>

<execution_context>
@/Users/jmaciejewski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jmaciejewski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-launch/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Confirm all three GHCR packages exist</name>
  <files></files>
  <action>
Before the human can set visibility, confirm each package exists in GHCR (packages are created lazily on first push).

Run these checks:

```bash
# Check agent and server packages exist (created by docker jobs on every main push)
curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-agent/tags/list
curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-server/tags/list
# Expected: 401 (exists but private). 404 means package does not exist yet.

# Check OCI chart package (only created on semver tag push via helm-release job)
curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/charts/pulltrace/tags/list
# Expected: 401 (exists but private). 404 means Phase 3 test tag did not push a chart yet.
```

Also check the Packages tab listing:
```bash
gh api /users/d44b/packages --jq '.[].name' 2>/dev/null || echo "check https://github.com/users/d44b/packages manually"
```

Report findings:
- If all three return 401: proceed to Task 2 (all packages exist and are private).
- If `charts/pulltrace` returns 404: the OCI chart package has never been pushed. In this case the visibility for `charts/pulltrace` cannot be set yet. Note this in the summary — the human will need to set it after Plan 04-02's CI run creates the package for the first time.
- If `pulltrace-agent` or `pulltrace-server` return 404: CI has never run the docker job on main. This is a blocker; investigate CI run history with `gh run list --workflow=ci.yml --repo d44b/pulltrace --limit 5`.
  </action>
  <verify>
    <automated>curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-agent/tags/list && curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-server/tags/list</automated>
    <manual>Both commands return 401 (package exists, private) or 200 (package exists, public). A 404 is a blocker.</manual>
  </verify>
  <done>All packages that exist return 401 or 200 from the GHCR v2 API. If charts/pulltrace returns 404, that is documented as deferred to post-tag-push.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Change visibility of all three GHCR packages to public</name>
  <files></files>
  <action>
Task 1 confirmed which packages exist. Now each package's visibility must be changed to Public via the GitHub Web UI. There is no CLI or REST API for this operation — it must be done by hand.

For each package that exists, navigate to the settings URL and change visibility to Public:

**Package 1: pulltrace-agent**
1. Go to: https://github.com/users/d44b/packages/container/pulltrace-agent/settings
2. Scroll to "Danger Zone" section
3. Click "Change visibility"
4. Select "Public"
5. Type `pulltrace-agent` to confirm
6. Click "I understand the consequences, change package visibility"

**Package 2: pulltrace-server**
1. Go to: https://github.com/users/d44b/packages/container/pulltrace-server/settings
2. Scroll to "Danger Zone" section
3. Click "Change visibility"
4. Select "Public"
5. Type `pulltrace-server` to confirm
6. Click "I understand the consequences, change package visibility"

**Package 3: charts/pulltrace** (only if it exists — Task 1 result)
1. Go to: https://github.com/users/d44b/packages/container/charts%2Fpulltrace/settings
   (The slash in "charts/pulltrace" must be URL-encoded as %2F)
2. If the URL 404s, navigate via: GitHub profile → Packages tab → select "charts/pulltrace" → Package settings gear
3. Scroll to "Danger Zone" section
4. Click "Change visibility"
5. Select "Public"
6. Type `charts/pulltrace` to confirm
7. Click "I understand the consequences, change package visibility"

**WARNING:** This action is irreversible. GHCR packages cannot be made private again once public.
  </action>
  <verify>
    <automated>docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-agent:latest 2>&1 | tail -3</automated>
    <manual>After setting visibility, run: docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-agent:latest && docker pull ghcr.io/d44b/pulltrace-server:latest — both must pull without "pull access denied" or 401.</manual>
  </verify>
  <done>All available packages are set to public. Unauthenticated docker pull succeeds for pulltrace-agent and pulltrace-server. If charts/pulltrace did not exist yet, that is documented as deferred.</done>
  <resume-signal>Type "packages public" when all available packages have been set to public visibility. If charts/pulltrace did not exist yet, type "packages public — charts deferred" and that package will be handled after Plan 04-02 creates it.</resume-signal>
</task>

</tasks>

<verification>
After this plan completes:

1. Unauthenticated docker pull succeeds for pulltrace-agent:
   ```bash
   docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-agent:latest
   ```
   Expected: Pull completes without "unauthorized" error.

2. Unauthenticated docker pull succeeds for pulltrace-server:
   ```bash
   docker pull ghcr.io/d44b/pulltrace-server:latest
   ```
   Expected: Pull completes without "unauthorized" error.

3. For charts/pulltrace (if it existed):
   ```bash
   helm show chart oci://ghcr.io/d44b/charts/pulltrace
   ```
   Expected: Returns Chart.yaml content, no authentication error.
</verification>

<success_criteria>
- `curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-agent/tags/list` returns 200 (was 401)
- `curl -s -o /dev/null -w "%{http_code}" https://ghcr.io/v2/d44b/pulltrace-server/tags/list` returns 200 (was 401)
- `docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-agent:latest` succeeds without auth error
- `docker logout ghcr.io && docker pull ghcr.io/d44b/pulltrace-server:latest` succeeds without auth error
- If charts/pulltrace existed: `helm show chart oci://ghcr.io/d44b/charts/pulltrace` succeeds without auth error
</success_criteria>

<output>
After completion, create `.planning/phases/04-launch/04-01-SUMMARY.md`

Required frontmatter fields:
- phase, plan, subsystem, tags, dependency_graph, tech_stack, key_files, decisions, metrics

Required body sections:
- What Was Done (per task)
- Must-Haves Verification table
- Commits (if any — this plan modifies no files, so no commits expected)
- Deviations from Plan
- Self-Check: PASSED or FAILED
</output>
