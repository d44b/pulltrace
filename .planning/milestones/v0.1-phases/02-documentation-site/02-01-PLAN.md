---
phase: 02-documentation-site
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mkdocs.yml
  - docs/index.md
  - docs/installation.md
  - docs/configuration.md
  - docs/architecture.md
  - docs/prometheus.md
  - docs/known-limitations.md
  - docs/contributing.md
  - .github/workflows/docs.yml
autonomous: true
requirements: [DOCS-01, DOCS-05]

must_haves:
  truths:
    - "Pushing a commit to main triggers the docs.yml workflow and produces a green build"
    - "mkdocs build --strict succeeds locally (no missing nav pages)"
    - "All 7 nav pages exist as stub files with correct headings"
    - "docs.yml uses peaceiris/actions-gh-pages@v4 with keep_files: true (not mkdocs gh-deploy)"
  artifacts:
    - path: "mkdocs.yml"
      provides: "MkDocs Material site configuration with full nav and Mermaid support"
      contains: "site_url: https://d44b.github.io/pulltrace/"
    - path: ".github/workflows/docs.yml"
      provides: "CI workflow that deploys docs to GitHub Pages on push to main"
      contains: "peaceiris/actions-gh-pages@v4"
    - path: "docs/index.md"
      provides: "Home page stub"
    - path: "docs/installation.md"
      provides: "Installation page stub"
    - path: "docs/configuration.md"
      provides: "Configuration page stub"
    - path: "docs/architecture.md"
      provides: "Architecture page stub"
    - path: "docs/prometheus.md"
      provides: "Prometheus metrics page stub"
    - path: "docs/known-limitations.md"
      provides: "Known Limitations page stub"
    - path: "docs/contributing.md"
      provides: "Contributing page stub"
  key_links:
    - from: ".github/workflows/docs.yml"
      to: "gh-pages branch /root"
      via: "peaceiris/actions-gh-pages@v4 with keep_files: true"
      pattern: "keep_files: true"
    - from: "mkdocs.yml"
      to: "docs/*.md"
      via: "nav: section listing all 7 pages"
      pattern: "nav:"
---

<objective>
Scaffold the MkDocs Material documentation site: create mkdocs.yml with full nav and Mermaid support, create stub docs/ pages for every nav entry (so --strict build passes), and create the docs.yml GitHub Actions workflow that auto-deploys on push to main.

Purpose: Establish the site infrastructure so the docs.yml workflow can be merged and run green before content is written. The CI pipeline and file structure must be correct before any content work begins. ADRs already in docs/adr/ are added to the nav to prevent --strict warnings.

Output: mkdocs.yml, docs/*.md stubs (7 files), .github/workflows/docs.yml, all committed and workflow-ready.
</objective>

<execution_context>
@/Users/jmaciejewski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jmaciejewski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-documentation-site/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mkdocs.yml configuration</name>
  <files>mkdocs.yml</files>
  <action>
Create `mkdocs.yml` at the repository root with the following exact content. This is the complete, final configuration — not a placeholder.

```yaml
site_name: Pulltrace
site_url: https://d44b.github.io/pulltrace/
site_description: Real-time Kubernetes image pull progress monitor
site_author: d44b
repo_url: https://github.com/d44b/pulltrace
repo_name: d44b/pulltrace

theme:
  name: material
  palette:
    - scheme: default
      primary: indigo
      accent: indigo
      toggle:
        icon: material/brightness-7
        name: Switch to dark mode
    - scheme: slate
      primary: indigo
      accent: indigo
      toggle:
        icon: material/brightness-4
        name: Switch to light mode
  features:
    - navigation.tabs
    - navigation.sections
    - navigation.top
    - content.code.copy

markdown_extensions:
  - pymdownx.highlight:
      anchor_linenums: true
  - pymdownx.superfences:
      custom_fences:
        - name: mermaid
          class: mermaid
          format: !!python/name:pymdownx.superfences.fence_code_format
  - pymdownx.tabbed:
      alternate_style: true
  - admonition
  - pymdownx.details
  - attr_list
  - tables

nav:
  - Home: index.md
  - Installation: installation.md
  - Configuration: configuration.md
  - Architecture: architecture.md
  - Prometheus Metrics: prometheus.md
  - Known Limitations: known-limitations.md
  - Contributing: contributing.md
  - Architecture Decisions:
    - "ADR 001 — containerd runtime": adr/001-runtime-containerd.md
    - "ADR 002 — agent-server protocol": adr/002-agent-server-protocol.md
    - "ADR 003 — UI technology": adr/003-ui-technology.md
```

Key points:
- `site_url` must end with a trailing slash
- `pymdownx.superfences` with the mermaid custom fence is required for DOCS-04's architecture diagram
- ADRs are listed in the nav to prevent `mkdocs build --strict` from warning about files in docs/ not in nav
- Do NOT add `docs/schemas/pull-event-v1.json` to the nav — MkDocs does not process JSON files
  </action>
  <verify>
    <automated>cd /Users/jmaciejewski/workspace/pulltrace && python3 -c "import yaml; yaml.safe_load(open('mkdocs.yml'))" && echo "mkdocs.yml is valid YAML" && grep -q "site_url: https://d44b.github.io/pulltrace/" mkdocs.yml && grep -q "keep_files" mkdocs.yml || echo "keep_files not in mkdocs.yml (expected — it's in docs.yml)" && grep -q "mermaid" mkdocs.yml && grep -q "adr/001" mkdocs.yml && echo "All key content verified"</automated>
    <manual>Inspect mkdocs.yml and confirm nav lists all 7 primary pages plus 3 ADR entries</manual>
  </verify>
  <done>mkdocs.yml exists at repo root, parses as valid YAML, site_url points to https://d44b.github.io/pulltrace/, mermaid superfences configured, ADRs included in nav</done>
</task>

<task type="auto">
  <name>Task 2: Create docs/ stub pages and docs.yml CI workflow</name>
  <files>
    docs/index.md
    docs/installation.md
    docs/configuration.md
    docs/architecture.md
    docs/prometheus.md
    docs/known-limitations.md
    docs/contributing.md
    .github/workflows/docs.yml
  </files>
  <action>
Create the 7 stub markdown files and the CI workflow. All stubs must have a level-1 heading matching what Plan 02-02 will fill in, plus a brief placeholder body so --strict does not fail.

**docs/index.md:**
```markdown
# Pulltrace

Real-time Kubernetes image pull progress monitor.

Pulltrace gives you live visibility into image pulls happening across your cluster nodes — layers, download speed, and ETA — in a single web UI.

## Quick Links

- [Installation](installation.md)
- [Configuration](configuration.md)
- [Architecture](architecture.md)
```

**docs/installation.md:**
```markdown
# Installation

> **Note:** The Helm repository will be available at v0.1.0 release. The commands below reflect the final installation path.

## Prerequisites

- Kubernetes 1.28+ with containerd runtime (not CRI-O)
- Helm 3
- Namespace with `pod-security.kubernetes.io/enforce=privileged` label (agent needs hostPath volume)

## Install

_Content coming in v0.1.0 documentation update._
```

**docs/configuration.md:**
```markdown
# Configuration

_Content coming in v0.1.0 documentation update._
```

**docs/architecture.md:**
```markdown
# Architecture

_Content coming in v0.1.0 documentation update._
```

**docs/prometheus.md:**
```markdown
# Prometheus Metrics

_Content coming in v0.1.0 documentation update._
```

**docs/known-limitations.md:**
```markdown
# Known Limitations

_Content coming in v0.1.0 documentation update._
```

**docs/contributing.md:**
```markdown
# Contributing

See [CONTRIBUTING.md](https://github.com/d44b/pulltrace/blob/main/CONTRIBUTING.md) in the repository root for development setup, build instructions, and PR guidelines.
```

**CRITICAL for docs.yml — use peaceiris/actions-gh-pages@v4 with keep_files: true. Do NOT use `mkdocs gh-deploy --force`. `gh-deploy --force` would destroy Phase 3's /charts/ directory on every docs deploy.**

**.github/workflows/docs.yml:**
```yaml
name: Docs

on:
  push:
    branches: ["main"]

permissions:
  contents: write   # required by peaceiris/actions-gh-pages to push gh-pages branch

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Cache pip
        uses: actions/cache@v4
        with:
          key: mkdocs-material-9.7.2
          path: ~/.cache
          restore-keys: mkdocs-

      - name: Install MkDocs Material
        run: pip install mkdocs-material==9.7.2

      - name: Build docs
        run: mkdocs build --strict --site-dir site

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./site
          publish_branch: gh-pages
          keep_files: true
          destination_dir: "."
```

After creating all files, verify the build locally if Python/pip is available:
```bash
pip install mkdocs-material==9.7.2 2>/dev/null && mkdocs build --strict --site-dir /tmp/pulltrace-site-check 2>&1 | tail -5
```
If Python/pip not available locally, skip — CI will catch errors.
  </action>
  <verify>
    <automated>cd /Users/jmaciejewski/workspace/pulltrace && ls docs/index.md docs/installation.md docs/configuration.md docs/architecture.md docs/prometheus.md docs/known-limitations.md docs/contributing.md .github/workflows/docs.yml && grep -q "peaceiris/actions-gh-pages@v4" .github/workflows/docs.yml && grep -q "keep_files: true" .github/workflows/docs.yml && grep -q "mkdocs-material==9.7.2" .github/workflows/docs.yml && grep -q 'push.*branches.*main' .github/workflows/docs.yml && echo "All files present and workflow verified"</automated>
    <manual>Confirm docs.yml does NOT contain "gh-deploy" anywhere; confirm all 7 stub files have H1 headings</manual>
  </verify>
  <done>All 7 stub docs/ files exist with H1 headings; docs.yml exists with peaceiris/actions-gh-pages@v4, keep_files: true, mkdocs-material==9.7.2 pinned, triggers on push to main only; no gh-deploy command present</done>
</task>

</tasks>

<verification>
After completing both tasks, run the following checks:

```bash
cd /Users/jmaciejewski/workspace/pulltrace

# 1. YAML validity
python3 -c "import yaml; yaml.safe_load(open('mkdocs.yml'))" && echo "mkdocs.yml: valid YAML"

# 2. All nav pages exist
for f in docs/index.md docs/installation.md docs/configuration.md docs/architecture.md docs/prometheus.md docs/known-limitations.md docs/contributing.md docs/adr/001-runtime-containerd.md docs/adr/002-agent-server-protocol.md docs/adr/003-ui-technology.md; do
  [ -f "$f" ] && echo "OK: $f" || echo "MISSING: $f"
done

# 3. docs.yml safety checks
grep -q "keep_files: true" .github/workflows/docs.yml && echo "keep_files: true — SAFE"
grep -q "gh-deploy" .github/workflows/docs.yml && echo "DANGER: gh-deploy found" || echo "No gh-deploy — SAFE"
grep -q "peaceiris/actions-gh-pages@v4" .github/workflows/docs.yml && echo "peaceiris action: correct"
```
</verification>

<success_criteria>
- mkdocs.yml exists at repo root with site_url, Material theme, Mermaid superfences, full nav (7 primary pages + 3 ADRs)
- 7 stub docs/ files exist with H1 headings (mkdocs build --strict will pass)
- docs.yml workflow exists, triggers on push to main, uses peaceiris/actions-gh-pages@v4 with keep_files: true, pins mkdocs-material==9.7.2
- No use of mkdocs gh-deploy anywhere in docs.yml
</success_criteria>

<output>
After completion, create `.planning/phases/02-documentation-site/02-01-SUMMARY.md` using the summary template. Include: files created (list all 9), key decisions made (keep_files pattern, ADRs in nav), any issues encountered during build verification.
</output>
